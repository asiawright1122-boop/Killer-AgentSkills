---
import Layout from '../../layouts/Layout.astro';
import SkillCard from '../../components/SkillCard.astro';
import OfficialSkills from '../../components/OfficialSkills.astro';
import SearchBar from '../../islands/SearchBar';
import { SUPPORTED_LOCALES, loadMessages, useTranslations, type Locale } from '../../i18n';
import { getFeaturedSkills } from '../../lib/skills';
import type { Env } from '../../lib/kv';

export const prerender = false;

// Validate locale
const { locale } = Astro.params;
if (!locale || !SUPPORTED_LOCALES.includes(locale as Locale)) {
  return new Response(null, { status: 404, statusText: 'Not Found' });
}

const typedLocale = locale as Locale;

// Get env from Cloudflare runtime
const env = (Astro.locals as any).runtime?.env as Env;

// Load featured skills from KV
const featuredSkills = await getFeaturedSkills(env, 6);

// Load translations
const messages = await loadMessages(typedLocale);
const t = useTranslations(messages);

// Features data with SVG paths (Lucide icons style)
const features = [
  { 
    iconPath: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z', // Shield
    color: 'sky' 
  },
  { 
    iconPath: 'M13 2L3 14h9l-1 8 10-12h-9l1-8z', // Zap (Standard Protocol)
    color: 'cyan' 
  },
  { 
    iconPath: 'M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09zM12 15l-3 3a2.21 2.21 0 0 0-.2 2.9c.76 1.45 3.2 2.6 3.2 2.6s1.15-2.44 2.6-3.2a2.21 2.21 0 0 0 2.9-.2l3-3M22 5V2l-5.83 5.83a2.21 2.21 0 0 0 0 3.12c1.45 1.45 2.6 3.2 2.6 3.2s-2.43 1.15-3.2 2.6a2.21 2.21 0 0 0-3.12 0l-1.04 1.05a7.22 7.22 0 0 1-2.18-4.57 6.13 6.13 0 0 1 .47-3.9 6.55 6.55 0 0 1 3.9-.47l1.05-1.04a2.21 2.21 0 0 0 0-3.12L7 11 3 7', // Rocket
    color: 'teal' 
  },
  { 
    iconPath: 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z', // Bulb
    color: 'blue' 
  },
];
---

<Layout
  locale={locale}
  title={t('Metadata.title')}
  description={t('Metadata.description')}
  appendBrand={false}
>
  {/* WebSite + Organization JSON-LD for sitelinks search box */}
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Killer-Skills",
    "url": "https://killer-skills.com",
    "description": t('Metadata.description'),
    "inLanguage": ["en", "zh", "ja", "ko", "es", "fr", "de", "pt", "ru", "ar"],
    "potentialAction": {
      "@type": "SearchAction",
      "target": {
        "@type": "EntryPoint",
        "urlTemplate": `https://killer-skills.com/${locale}/skills?q={search_term_string}`
      },
      "query-input": "required name=search_term_string"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Killer-Skills",
      "url": "https://killer-skills.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://killer-skills.com/og-image.png"
      }
    }
  })} />
  {/* Organization JSON-LD for Knowledge Panel */}
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Killer-Skills",
    "url": "https://killer-skills.com",
    "logo": "https://killer-skills.com/og-image.png",
    "description": t('Metadata.description'),
    "sameAs": [
      "https://github.com/anthropics/skills",
      "https://discord.gg/killer-skills",
      "https://twitter.com/killerskills"
    ]
  })} />
  <main class="flex-1 w-full">

    <!-- Hero Section -->
    <section class="relative overflow-hidden pt-24 pb-32 lg:pt-32 lg:pb-40">
      <!-- Background Gradients - Deep Ocean -->
      <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[500px] bg-sky-500/10 rounded-full blur-[100px] -z-10 animate-pulse-glow"></div>
      <div class="absolute bottom-0 right-0 w-[800px] h-[600px] bg-blue-600/5 rounded-full blur-[120px] -z-10"></div>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <div class="inline-flex items-center px-4 py-1.5 rounded-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 text-slate-600 dark:text-slate-300 text-sm font-medium mb-8 shadow-sm">
          <span class="w-2 h-2 rounded-full bg-sky-500 mr-2 animate-pulse"></span>
          {t('Home.heroBadge')}
        </div>

        <h1 class="text-5xl md:text-7xl font-bold tracking-tight text-slate-900 dark:text-white mb-6 text-balance">
          {t('Home.heroTitle')} <br class="hidden md:block" />
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-sky-500 to-blue-600 dark:from-sky-400 dark:to-blue-500">
            {t('Home.heroTitleHighlight')}
          </span>
        </h1>

        <p class="text-xl text-slate-600 dark:text-slate-400 max-w-2xl mx-auto mb-4 text-balance font-light">
          {t('Home.heroDesc1')}
        </p>
        <p class="text-lg text-slate-500 dark:text-slate-500 max-w-2xl mx-auto mb-10 text-balance font-light">
          {t('Home.heroDesc2')}
        </p>

        <!-- Search Bar (React Island) -->
        <div class="max-w-xl mx-auto">
          <SearchBar client:load locale={locale} placeholder={t('Home.searchPlaceholder')} />
          <div class="flex items-center justify-center gap-2 mt-3 text-sm text-slate-400">
            <span>{t('Hero.hotTags')}</span>
            {(Array.isArray(messages.Home?.tags) ? messages.Home.tags : ['Research', 'Coding', 'Marketing', 'Analysis']).map((tag: string) => (
              <a
                href={`/${locale}/skills?q=${encodeURIComponent(tag)}`}
                class="text-slate-500 dark:text-slate-300 hover:text-sky-600 dark:hover:text-sky-400 transition-colors"
              >
                {tag}
              </a>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- Official Skills Section -->
    <OfficialSkills locale={locale} />

    <!-- Stats Section -->
    <section class="border-y border-slate-200/60 dark:border-slate-800/60 bg-slate-50/50 dark:bg-slate-900/50 py-12">
      <div class="max-w-7xl mx-auto px-6">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
          <div>
            <div class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-blue-600 mb-2">2,500+</div>
            <div class="text-sm text-slate-500 dark:text-slate-400 font-medium uppercase tracking-wider">{t('Stats.totalSkills')}</div>
          </div>
          <div>
            <div class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-blue-600 mb-2">50k+</div>
            <div class="text-sm text-slate-500 dark:text-slate-400 font-medium uppercase tracking-wider">{t('Stats.totalDownloads')}</div>
          </div>
          <div>
            <div class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-blue-600 mb-2">120+</div>
            <div class="text-sm text-slate-500 dark:text-slate-400 font-medium uppercase tracking-wider">{t('Stats.activeCreators')}</div>
          </div>
          <div>
            <div class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-blue-600 mb-2">15+</div>
            <div class="text-sm text-slate-500 dark:text-slate-400 font-medium uppercase tracking-wider">{t('Stats.supportedIDEs')}</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Featured Skills -->
    <section class="py-24 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between mb-12">
        <div>
          <h2 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">{t('Home.trendingTitle')}</h2>
          <p class="text-slate-500">{t('Home.trendingSubtitle')}</p>
        </div>
        <a href={`/${locale}/skills`} class="group flex items-center gap-1 text-sky-600 dark:text-sky-400 font-medium hover:text-sky-700 dark:hover:text-sky-300 transition-colors">
          {t('Home.viewAll')}
          <span class="group-hover:translate-x-1 transition-transform">â†’</span>
        </a>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {featuredSkills.length > 0 ? (
          featuredSkills.map(skill => (
            <SkillCard skill={skill} locale={locale} t={t} />
          ))
        ) : (
          <!-- Fallback when no skills loaded from KV -->
          <div class="col-span-full text-center py-12 text-slate-500">
            <p>{t('Skills.noResults')}</p>
          </div>
        )}
      </div>
    </section>

    <!-- Features Grid -->
    <section class="bg-slate-50 dark:bg-slate-950 py-24 border-t border-slate-200 dark:border-slate-800">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center max-w-3xl mx-auto mb-16">
          <h2 class="text-3xl font-bold text-slate-900 dark:text-white mb-4">{t('Home.featuresTitle')}</h2>
          <p class="text-slate-500 text-lg">{t('Home.featuresSubtitle')}</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12">
          {features.map((feature, i) => (
            <div class="text-center group">
              <div class={`w-16 h-16 mx-auto bg-${feature.color}-50 dark:bg-${feature.color}-900/20 text-${feature.color}-600 dark:text-${feature.color}-400 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300 border border-${feature.color}-100 dark:border-${feature.color}-800`}>
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d={feature.iconPath} />
                </svg>
              </div>
              <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-3">
                {t(`Home.features.${i}.title`)}
              </h3>
              <p class="text-slate-600 dark:text-slate-400 leading-relaxed">
                {t(`Home.features.${i}.desc`)}
              </p>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="py-24">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl font-bold text-slate-900 dark:text-white mb-4">{t('Home.cta.title')}</h2>
        <p class="text-lg text-slate-500 mb-8">{t('Home.cta.subtitle')}</p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
          <a
            href={`/${locale}/skills`}
            class="px-8 py-3 bg-cyan-600 hover:bg-cyan-700 text-white font-medium rounded-xl transition-colors shadow-lg shadow-cyan-500/20"
          >
            {t('Home.cta.browse')}
          </a>
          <a
            href={`/${locale}/docs`}
            class="px-8 py-3 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 text-slate-700 dark:text-slate-300 font-medium rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
          >
            {t('Home.cta.docs')}
          </a>
        </div>
      </div>
    </section>

  </main>
</Layout>
