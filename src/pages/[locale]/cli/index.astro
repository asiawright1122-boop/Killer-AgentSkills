---
import Layout from '../../../layouts/Layout.astro';
import { SUPPORTED_LOCALES, loadMessages, useTranslations, type Locale } from '../../../i18n';
import docsCache from '../../../../data/docs-cache.json';
import { Sparkles, RefreshCw, Bot, Shield, Check, X, Minus } from 'lucide-react';

export const prerender = false;

// Validate locale
const { locale } = Astro.params;
if (!locale || !SUPPORTED_LOCALES.includes(locale as Locale)) {
  return new Response(null, { status: 404, statusText: 'Not Found' });
}

const typedLocale = locale as Locale;

// Load translations
const messages = await loadMessages(typedLocale);
const t = useTranslations(messages);

const pageTitle = `${t('CLI.command')} ${t('CLI.terminal')}`;
const pageDescription = t('CLI.heroDesc');

const featureCards = [
  { title: t('CLI.cards.fast.title'), desc: t('CLI.cards.fast.desc'), icon: Sparkles },
  { title: t('CLI.cards.integration.title'), desc: t('CLI.cards.integration.desc'), icon: RefreshCw },
  { title: t('CLI.cards.sandbox.title'), desc: t('CLI.cards.sandbox.desc'), icon: Shield },
];

const getDocContent = (slug: string) => {
  const page = (docsCache as any).pages.find((p: any) => p.slug === slug);
  return page?.content[typedLocale] || page?.content['en'] || '';
};

const commandsContent = getDocContent('cli/commands');
const configContent = getDocContent('cli/configuration');
---

<Layout locale={locale} title={pageTitle} description={pageDescription}>
  {/* BreadcrumbList JSON-LD */}
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": t('Common.home'), "item": `https://killer-skills.com/${locale}` },
      { "@type": "ListItem", "position": 2, "name": "CLI", "item": `https://killer-skills.com/${locale}/cli` }
    ]
  })} />
  {/* FAQ JSON-LD for CLI page */}
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What is the Killer-Skills CLI?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The Killer-Skills CLI is a universal command-line tool that lets you install, manage, and sync AI agent skills across 15+ IDEs including Cursor, Windsurf, VS Code, Claude Code, and JetBrains. No global installation required — just use npx."
        }
      },
      {
        "@type": "Question",
        "name": "How do I install a skill using the CLI?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Run 'npx killer-skills add owner/repo' in your terminal. The CLI automatically detects your IDE and configures the skill file in the correct format (.cursorrules, CLAUDE.md, etc.)."
        }
      },
      {
        "@type": "Question",
        "name": "Which IDEs does the Killer-Skills CLI support?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The CLI supports 15+ IDEs: Cursor (.cursorrules), Claude Code (CLAUDE.md), VS Code/GitHub Copilot (.github/copilot-instructions.md), Windsurf (.windsurfrules), JetBrains (.junie/guidelines.md), Cline (.clinerules), Roo Code (.roo/rules.md), Aider (.aider.conf), Continue (.continue/rules), Codex (AGENTS.md), and more."
        }
      },
      {
        "@type": "Question",
        "name": "Do I need to install the CLI globally?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "No! The CLI works via npx, which means no global installation is required. Just run 'npx killer-skills <command>' and it will download and execute automatically."
        }
      },
      {
        "@type": "Question",
        "name": "What is the 'killer do' command?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The 'killer do' command uses AI to automatically match your natural language task description to the best locally installed skill. For example, 'killer do create a PDF from images' will auto-detect and invoke your PDF skill."
        }
      }
    ]
  })} />
  {/* SoftwareApplication JSON-LD for CLI */}
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "Killer-Skills CLI",
    "operatingSystem": "Windows, macOS, Linux",
    "applicationCategory": "DeveloperApplication",
    "description": pageDescription,
    "url": `https://killer-skills.com/${locale}/cli`,
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "softwareVersion": "1.7.0"
  })} />

  <div class="bg-slate-50 dark:bg-black min-h-screen overflow-hidden">
    
    {/* Hero Section */}
    <div class="relative pt-24 pb-16 md:pt-32 md:pb-24 overflow-hidden">
      <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-cyan-400/20 via-slate-50 dark:via-black to-slate-50 dark:to-black opacity-40"></div>
      
      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center z-10">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-cyan-500/10 text-cyan-600 dark:text-cyan-400 text-sm font-medium mb-6 border border-cyan-500/20">
          <span class="w-2 h-2 rounded-full bg-cyan-500 animate-pulse"></span>
          {t('CLI.features.autoInvoke.title')}
        </div>
        
        <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold text-slate-900 dark:text-white mb-6 tracking-tight leading-tight">
          {t('CLI.heroTitle')} <br/>
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-blue-600">
            {t('CLI.heroSubtitle')}
          </span>
        </h1>
        
        <p class="text-xl text-slate-600 dark:text-slate-400 max-w-2xl mx-auto mb-10 leading-relaxed">
          {t('CLI.heroDesc')} <br/>
          <span class="text-base text-slate-500 dark:text-slate-500 mt-4 block">
            {t('CLI.optionalNote')}
          </span>
        </p>
        
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-16">
          <div class="relative group cursor-pointer transition-all duration-300 hover:-translate-y-1" onclick="navigator.clipboard.writeText('npx killer-skills install <skill>'); alert('Copied!')">
            <div class="absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-xl opacity-20 group-hover:opacity-40 blur transition duration-300"></div>
            <div class="relative px-6 py-3.5 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm flex items-center gap-4">
              <div class="font-mono text-sm flex items-center gap-3">
                <span class="text-slate-400 dark:text-slate-500 select-none">$</span>
                <span class="text-slate-700 dark:text-cyan-400 font-medium">npx killer-skills <span class="text-slate-400 dark:text-slate-500">install</span> &lt;skill&gt;</span>
              </div>
              <div class="pl-4 border-l border-slate-200 dark:border-slate-800 text-slate-400 group-hover:text-cyan-500 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
              </div>
            </div>
            <div class="absolute -bottom-6 left-0 right-0 text-center text-xs text-slate-500 dark:text-slate-500 opacity-0 group-hover:opacity-100 transition-opacity">
              No installation required
            </div>
          </div>
          
          <a href={`/${locale}/docs`} class="px-6 py-3.5 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white border border-slate-200 dark:border-slate-700 font-medium hover:bg-white dark:hover:bg-slate-700 transition-all shadow-sm hover:shadow-md">
            {t('CLI.viewDocs')}
          </a>
        </div>
      </div>
    </div>

    {/* Terminal Showcase & Comparison Grid */}
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-32 -mt-10 relative z-20">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-stretch">
        {/* Comparison Table */}
        <div class="h-full flex flex-col rounded-2xl overflow-hidden shadow-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-[#0d1117] transition-colors duration-300">
          <div class="flex items-center gap-2 px-6 py-4 bg-slate-50 dark:bg-[#161b22] border-b border-slate-200 dark:border-slate-800">
            <h2 class="text-sm font-mono font-bold text-slate-900 dark:text-white tracking-wide uppercase">{t('CLI.comparison.title')}</h2>
          </div>
          
          <div class="flex-1 p-0 bg-white dark:bg-slate-900/50">
            <table class="w-full text-left text-sm h-full">
              <thead class="bg-slate-50 dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-800">
                <tr>
                  <th class="p-4 font-medium text-slate-500 dark:text-slate-400">Feature</th>
                  <th class="p-4 font-bold text-cyan-600 dark:text-cyan-400">{t('CLI.comparison.ks')}</th>
                  <th class="p-4 font-medium text-slate-500 dark:text-slate-400">{t('CLI.comparison.others')}</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-200 dark:divide-slate-800 bg-white dark:bg-slate-900">
                <tr>
                  <td class="p-4 text-slate-900 dark:text-white font-medium">{t('CLI.comparison.row1')}</td>
                  <td class="p-4"><Check className="w-5 h-5 text-cyan-600 dark:text-cyan-400" /></td>
                  <td class="p-4"><X className="w-5 h-5 text-slate-400" /></td>
                </tr>
                <tr>
                  <td class="p-4 text-slate-900 dark:text-white font-medium">{t('CLI.comparison.row2')}</td>
                  <td class="p-4"><Check className="w-5 h-5 text-cyan-600 dark:text-cyan-400" /></td>
                  <td class="p-4"><X className="w-5 h-5 text-slate-400" /></td>
                </tr>
                <tr>
                  <td class="p-4 text-slate-900 dark:text-white font-medium">{t('CLI.comparison.row3')}</td>
                  <td class="p-4"><Check className="w-5 h-5 text-cyan-600 dark:text-cyan-400" /></td>
                  <td class="p-4"><X className="w-5 h-5 text-slate-400" /></td>
                </tr>
                <tr>
                  <td class="p-4 text-slate-900 dark:text-white font-medium">{t('CLI.comparison.row4')}</td>
                  <td class="p-4"><Check className="w-5 h-5 text-cyan-600 dark:text-cyan-400" /></td>
                  <td class="p-4"><Minus className="w-5 h-5 text-slate-400" /></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        {/* Terminal Window */}
        <div class="h-full flex flex-col rounded-2xl overflow-hidden shadow-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-[#0d1117] transition-colors duration-300">
          <div class="flex items-center gap-2 px-4 py-3 bg-slate-50 dark:bg-[#161b22] border-b border-slate-200 dark:border-slate-800">
            <div class="flex gap-2 group">
              <div class="w-3 h-3 rounded-full bg-red-500/80 group-hover:bg-red-500 shadow-sm transition-colors"></div>
              <div class="w-3 h-3 rounded-full bg-yellow-500/80 group-hover:bg-yellow-500 shadow-sm transition-colors"></div>
              <div class="w-3 h-3 rounded-full bg-green-500/80 group-hover:bg-green-500 shadow-sm transition-colors"></div>
            </div>
            <div class="flex-1 text-center mr-16 font-mono text-xs text-slate-400 font-medium tracking-wide">
              killer-skills — v1.7.0
            </div>
          </div>
          <div class="p-6 md:p-8 font-mono text-sm leading-relaxed text-slate-600 dark:text-slate-300">
            <div class="mb-6">
              <span class="text-green-600 dark:text-green-400">➜</span> <span class="text-cyan-600 dark:text-cyan-400">~</span> <div class="inline-block text-slate-400 select-none mx-2">$</div>
              <span class="text-slate-900 dark:text-white font-medium typing-effect">killer login</span><br/>
              <div class="mt-2 pl-4 border-l-2 border-green-500/30">
                <span class="text-green-600 dark:text-green-400 font-bold">✓</span> <span class="text-slate-700 dark:text-slate-300">Login successful via GitHub Device Flow</span>
              </div>
            </div>
            
            <div class="mb-6">
              <span class="text-green-600 dark:text-green-400">➜</span> <span class="text-cyan-600 dark:text-cyan-400">~</span> <div class="inline-block text-slate-400 select-none mx-2">$</div>
              <span class="text-slate-900 dark:text-white font-medium">killer sync --all</span><br/>
              <div class="mt-2 text-slate-500 dark:text-slate-400">Syncing skills to 17 IDEs...</div>
              <div class="space-y-1 mt-1">
                <div><span class="text-green-600 dark:text-green-400">✔</span> <span class="text-slate-800 dark:text-slate-200 font-medium">Cursor</span>  <span class="text-slate-400 text-xs ml-2">→ .cursorrules</span></div>
                <div><span class="text-green-600 dark:text-green-400">✔</span> <span class="text-slate-800 dark:text-slate-200 font-medium">Claude</span>  <span class="text-slate-400 text-xs ml-2">→ CLAUDE.md</span></div>
                <div><span class="text-green-600 dark:text-green-400">✔</span> <span class="text-slate-800 dark:text-slate-200 font-medium">VSCode</span>  <span class="text-slate-400 text-xs ml-2">→ .github/copilot-instructions.md</span></div>
              </div>
              <div class="mt-2 pl-4 border-l-2 border-green-500/30 text-slate-700 dark:text-slate-300">
                <span class="text-green-600 dark:text-green-400 font-bold">✓</span> Synced 21 skills to 3 IDEs
              </div>
            </div>

            <div>
              <span class="text-green-600 dark:text-green-400">➜</span> <span class="text-cyan-600 dark:text-cyan-400">~</span> <div class="inline-block text-slate-400 select-none mx-2">$</div>
              <span class="text-slate-900 dark:text-white font-medium">killer do "create a PDF from images"</span><br/>
              <div class="mt-2">
                <span class="text-purple-600 dark:text-purple-400">⚡ Auto-matched local skill: </span><span class="bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 px-1.5 py-0.5 rounded text-xs font-bold ring-1 ring-yellow-500/20">pdf</span>
              </div>
              <div class="text-slate-500 dark:text-slate-400 animate-pulse">▶ Executing skill instructions...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {/* Bento Grid Features */}
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-32">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {/* Large Card */}
        <div class="md:col-span-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-3xl p-8 shadow-sm hover:shadow-md transition-shadow">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white text-2xl mb-6">
            <Sparkles className="w-6 h-6" />
          </div>
          <h3 class="text-2xl font-bold text-slate-900 dark:text-white mb-3">{t('CLI.features.autoInvoke.title')}</h3>
          <p class="text-slate-600 dark:text-slate-400 text-lg">{t('CLI.features.autoInvoke.desc')}</p>
        </div>

        {/* Small Card */}
        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-3xl p-8 shadow-sm hover:shadow-md transition-shadow">
          <div class="w-12 h-12 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-2xl mb-6 text-slate-900 dark:text-white">
            <RefreshCw className="w-6 h-6" />
          </div>
          <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-3">{t('CLI.features.syncAll.title')}</h3>
          <p class="text-slate-600 dark:text-slate-400">{t('CLI.features.syncAll.desc')}</p>
        </div>

        {/* Small Card */}
        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-3xl p-8 shadow-sm hover:shadow-md transition-shadow">
          <div class="w-12 h-12 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-2xl mb-6 text-slate-900 dark:text-white">
            <Bot className="w-6 h-6" />
          </div>
          <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-3">{t('CLI.features.mcp.title')}</h3>
          <p class="text-slate-600 dark:text-slate-400">{t('CLI.features.mcp.desc')}</p>
        </div>

        {/* Large Card */}
        <div class="md:col-span-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-3xl p-8 shadow-sm hover:shadow-md transition-shadow">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center text-white text-2xl mb-6">
            <Shield className="w-6 h-6" />
          </div>
          <h3 class="text-2xl font-bold text-slate-900 dark:text-white mb-3">{t('CLI.features.secure.title')}</h3>
          <p class="text-slate-600 dark:text-slate-400 text-lg">{t('CLI.features.secure.desc')}</p>
        </div>
      </div>
    </div>



    {/* Commands Section */}
    <div id="commands" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mb-32 scroll-mt-24">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-slate-900 dark:text-white">CLI Commands</h2>
      </div>
      <article class="prose prose-lg prose-slate dark:prose-invert max-w-none 
          prose-headings:font-bold prose-headings:tracking-tight
          prose-a:text-cyan-600 dark:prose-a:text-cyan-400 prose-a:no-underline hover:prose-a:underline
          prose-code:bg-slate-100 dark:prose-code:bg-slate-800 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded-md prose-code:font-medium prose-code:text-cyan-600 dark:prose-code:text-cyan-300
          prose-img:rounded-2xl prose-img:shadow-lg prose-img:border prose-img:border-slate-200 dark:prose-img:border-slate-800" 
          set:html={commandsContent} 
      />
    </div>

    {/* Configuration Section */}
    <div id="configuration" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mb-32 scroll-mt-24">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-slate-900 dark:text-white">Configuration</h2>
      </div>
      <article class="prose prose-lg prose-slate dark:prose-invert max-w-none 
          prose-headings:font-bold prose-headings:tracking-tight
          prose-a:text-cyan-600 dark:prose-a:text-cyan-400 prose-a:no-underline hover:prose-a:underline
          prose-code:bg-slate-100 dark:prose-code:bg-slate-800 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded-md prose-code:font-medium prose-code:text-cyan-600 dark:prose-code:text-cyan-300
          prose-img:rounded-2xl prose-img:shadow-lg prose-img:border prose-img:border-slate-200 dark:prose-img:border-slate-800" 
          set:html={configContent} 
      />
    </div>

  </div>
</Layout>

<script>
  function addCopyButtons() {
    const preBlocks = document.querySelectorAll('article pre');
    
    preBlocks.forEach((pre) => {
      if (pre.closest('.code-block-wrapper')) return;

      const wrapper = document.createElement('div');
      wrapper.className = 'code-block-wrapper relative group my-6';
      
      if (pre.parentNode) {
        pre.parentNode.insertBefore(wrapper, pre);
        pre.style.marginTop = '0';
        pre.style.marginBottom = '0';
        wrapper.appendChild(pre);
        
        const btn = document.createElement('button');
        btn.className = 'copy-btn absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-lg bg-white/70 dark:bg-slate-800/60 text-slate-500 dark:text-slate-400 hover:bg-white hover:text-cyan-600 dark:hover:bg-slate-700 dark:hover:text-cyan-400 border border-slate-200/60 dark:border-slate-700/60 backdrop-blur-md transition-all duration-200 shadow-sm opacity-0 group-hover:opacity-100 focus:opacity-100 z-10';
        btn.setAttribute('aria-label', 'Copy to clipboard');
        
        const copyIcon = `
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
          </svg>
        `;

        const checkIcon = `
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-500 dark:text-emerald-400">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        `;

        btn.innerHTML = copyIcon;

        btn.addEventListener('click', async () => {
          try {
            const code = pre.querySelector('code')?.innerText || pre.innerText;
            await navigator.clipboard.writeText(code);
            btn.innerHTML = checkIcon;
            btn.classList.add('border-emerald-500/30', 'bg-emerald-50/50', 'dark:bg-emerald-900/20');
            setTimeout(() => {
              btn.innerHTML = copyIcon;
              btn.classList.remove('border-emerald-500/30', 'bg-emerald-50/50', 'dark:bg-emerald-900/20');
            }, 2000);
          } catch (err) {
            console.error('Failed to copy!', err);
          }
        });

        wrapper.appendChild(btn);
      }
    });
  }

  addCopyButtons();
  document.addEventListener('astro:page-load', addCopyButtons);
</script>

<style>
  @reference "../../../styles/global.css";

  /* Fix code block styling by resetting prose-code styles inside pre */
  article :global(pre code) {
    background-color: transparent !important;
    color: inherit !important;
    padding: 0 !important;
    border-radius: 0 !important;
    font-weight: inherit !important;
  }

  /* Style the pre block to look like a terminal/code editor - Matching docs/[...slug].astro */
  article :global(pre) {
    @apply relative rounded-xl p-5 my-6 overflow-x-auto shadow-sm border text-sm leading-relaxed;
    @apply bg-slate-50 text-slate-800 border-slate-200;
    white-space: pre-wrap;
    word-break: break-word;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }

  :global(.dark) article :global(pre) {
    @apply bg-slate-950 text-slate-50 border-slate-800;
  }

  article :global(pre):hover .copy-btn,
  article :global(pre) .copy-btn:focus {
    opacity: 1;
  }
</style>
